<!DOCTYPE html>
<html>
<head>
  <title>Autodialer Dashboard</title>
</head>
<body>
  <!-- Navigation Bar -->
  <nav style="background: #343a40; color: white; padding: 15px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center;">
      <h1 style="margin: 0; font-size: 24px;">ðŸ“ž Autodialer</h1>
      <div style="display: flex; gap: 20px;">
        <%= link_to "ðŸ  Home", root_path, style: "color: white; text-decoration: none; font-weight: 500;" %>
        <%= link_to "ðŸ“ž Autodialer", calls_path, style: "color: white; text-decoration: none; font-weight: 500; opacity: 0.7;" %>
        <%= link_to "ðŸ“š Blog", articles_path, style: "color: white; text-decoration: none; font-weight: 500;" %>
      </div>
    </div>
  </nav>

  <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
    
    <!-- Stats Section -->
    <div class="stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
      <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #6c757d;">
        <h3 style="margin: 0; color: #6c757d; font-size: 14px; text-transform: uppercase;">Total</h3>
        <p style="font-size: 32px; font-weight: bold; margin: 10px 0 0 0; color: #333;"><%= @stats[:total] %></p>
      </div>
      <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #28a745;">
        <h3 style="margin: 0; color: #28a745; font-size: 14px; text-transform: uppercase;">Completed</h3>
        <p style="font-size: 32px; font-weight: bold; margin: 10px 0 0 0; color: #333;"><%= @stats[:completed] %></p>
      </div>
      <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #dc3545;">
        <h3 style="margin: 0; color: #dc3545; font-size: 14px; text-transform: uppercase;">Failed</h3>
        <p style="font-size: 32px; font-weight: bold; margin: 10px 0 0 0; color: #333;"><%= @stats[:failed] %></p>
      </div>
      <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #007bff;">
        <h3 style="margin: 0; color: #007bff; font-size: 14px; text-transform: uppercase;">In Progress</h3>
        <p style="font-size: 32px; font-weight: bold; margin: 10px 0 0 0; color: #333;"><%= @stats[:in_progress] %></p>
      </div>
      <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #ffc107;">
        <h3 style="margin: 0; color: #ffc107; font-size: 14px; text-transform: uppercase;">Answered</h3>
        <p style="font-size: 32px; font-weight: bold; margin: 10px 0 0 0; color: #333;"><%= @stats[:answered] %></p>
      </div>
    </div>
    
    <!-- AI Prompt Section -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <h2 style="margin: 0 0 10px 0; color: white; font-size: 24px;">ðŸ¤– AI Command Center</h2>
      <p style="color: rgba(255,255,255,0.9); margin: 0 0 20px 0;">Type natural commands like: "call 18001234567" or "dial +911800456789"</p>
      <%= form_with url: ai_prompt_calls_path, method: :post do |f| %>
        <div style="display: flex; gap: 12px;">
          <%= f.text_field :prompt, 
              placeholder: "e.g., call 18001234567", 
              style: "flex: 1; padding: 14px; font-size: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; background: rgba(255,255,255,0.95);" %>
          <%= f.submit "Execute", style: "padding: 14px 28px; background: white; color: #667eea; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;" %>
        </div>
      <% end %>
    </div>
    
    <!-- Bulk Upload Section -->
    <div style="background: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="margin: 0 0 15px 0; color: #333;">ðŸ“‹ Bulk Upload Phone Numbers</h2>
      
      <%= form_with url: batch_upload_calls_path, method: :post, multipart: true do |f| %>
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">Paste numbers (one per line or comma-separated):</label>
          <%= f.text_area :numbers_text, 
              rows: 6, 
              placeholder: "18001234567\n18009876543\n18005554444\n...",
              style: "width: 100%; padding: 12px; font-size: 14px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: monospace; resize: vertical;" %>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">Or upload a file (.txt or .csv):</label>
          <%= f.file_field :numbers_file, 
              accept: ".txt,.csv",
              style: "padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; width: 100%;" %>
        </div>
        
        <%= f.submit "Upload Numbers", style: "padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;" %>
      <% end %>
      
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #17a2b8;">
        <strong style="color: #0c5460;">ðŸ’¡ Testing Tip:</strong>
        <p style="margin: 8px 0 0 0; color: #0c5460; font-size: 14px;">
          Use 1-800 numbers for testing. Without verified Twilio numbers, calls will be simulated.
          Format: 18001234567 (US) or +911234567890 (India)
        </p>
      </div>
    </div>
    
    <!-- Start Calling Button -->
    <div style="margin-bottom: 40px; text-align: center;">
      <%= button_to "ðŸš€ Start Calling All Pending Numbers", 
          start_calling_calls_path, 
          method: :post,
          data: { confirm: "Start calling all pending numbers? This will process all numbers in the queue." },
          style: "padding: 18px 40px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(245,87,108,0.4);" %>
    </div>
    
    <!-- Call Logs Table -->
    <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="margin: 0 0 20px 0; color: #333;">ðŸ“Š Call Logs</h2>
      
      <% if @calls.any? %>
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">#</th>
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">Phone Number</th>
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">Status</th>
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">Type</th>
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">Duration</th>
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">Answered</th>
                <th style="padding: 15px; text-align: left; font-weight: 600; color: #495057;">Time</th>
              </tr>
            </thead>
            <tbody>
              <% @calls.each_with_index do |call, index| %>
                <tr style="border-bottom: 1px solid #dee2e6;">
                  <td style="padding: 15px; color: #6c757d;"><%= index + 1 %></td>
                  <td style="padding: 15px; font-family: monospace; color: #495057; font-weight: 500;"><%= call.phone_number %></td>
                  <td style="padding: 15px;">
                    <span style="padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 500; background: <%= call.status_color %>; color: white;">
                      <%= call.status %>
                    </span>
                  </td>
                  <td style="padding: 15px; font-size: 13px;"><%= call.call_type %></td>
                  <td style="padding: 15px; color: #495057;"><%= call.formatted_duration %></td>
                  <td style="padding: 15px; font-size: 20px;"><%= call.answered ? 'âœ…' : 'âŒ' %></td>
                  <td style="padding: 15px; color: #6c757d; font-size: 13px;"><td><%= call.created_at.in_time_zone('Asia/Kolkata').strftime("%b %d, %I:%M %p") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
          <div style="font-size: 64px; margin-bottom: 20px;">ðŸ“ž</div>
          <h3 style="margin: 0 0 10px 0; color: #495057;">No calls yet</h3>
          <p style="margin: 0; color: #6c757d;">Upload some phone numbers to get started!</p>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Flash Messages -->
  <% if notice %>
    <div style="position: fixed; top: 80px; right: 20px; background: #28a745; color: white; padding: 16px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000;">
      <%= notice %>
    </div>
  <% end %>
  
  <% if alert %>
    <div style="position: fixed; top: 80px; right: 20px; background: #dc3545; color: white; padding: 16px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000;">
      <%= alert %>
    </div>
  <% end %>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }
  </style>
</body>
</html>